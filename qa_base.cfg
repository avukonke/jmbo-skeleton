[buildout]
extensions=
    lovely.buildouthttp
parts=
    skeleton
    skeleton-supervisor
    skeleton-nginx
    skeleton-haproxy
    directories
    media-links
eggs=
    psycopg2
    jmbo-skeleton
extends = 
    versions.cfg
versions = versions    
develop = .
unzip = true
auto-checkout = *

port-prefix = PORT_PREFIX_PLACEHOLDER
site-type = SITE_TYPE_PLACEHOLDER
site-name = SITE_NAME_PLACEHOLDER

[skeleton]
recipe = djangorecipe
project = skeleton
projectegg = skeleton
eggs = ${buildout:eggs}
settings = settings_qa_${buildout:site-type}_${buildout:site-name}
control-script = skeleton-qa-${buildout:site-type}-${buildout:site-name}

[skeleton-supervisor-django]
recipe = collective.recipe.template
input = buildout_templates/supervisor.django.in
output = ${buildout:directory}/supervisor/skeleton-qa-${buildout:site-type}-${buildout:site-name}-django.conf
name = skeleton-qa-${buildout:site-type}-${buildout:site-name}
control-script = skeleton-qa-${buildout:site-type}-${buildout:site-name}
host = 127.0.0.1
max-requests = 10000
user = www-data
log = ${buildout:directory}/../log/skeleton-qa-${buildout:site-type}-${buildout:site-name}/supervisor-django.log
error-log = ${buildout:directory}/../log/skeleton-qa-${buildout:site-type}-${buildout:site-name}/supervisor-django-error.log

[skeleton-supervisor-deviceproxy]
recipe = collective.recipe.template
input = buildout_templates/supervisor.deviceproxy.in
output = ${buildout:directory}/supervisor/skeleton-qa-${buildout:site-type}-${buildout:site-name}-deviceproxy.conf
name = skeleton-qa-${buildout:site-name}
user = www-data
log = ${buildout:directory}/../log/skeleton-qa-${buildout:site-type}-${buildout:site-name}/supervisor-deviceproxy.log
error-log = ${buildout:directory}/../log/skeleton-qa-${buildout:site-type}-${buildout:site-name}/supervisor-deviceproxy-error.log

[skeleton-nginx]
recipe = collective.recipe.template
input = buildout_templates/nginx.conf.in
output = ${buildout:directory}/nginx/skeleton-qa-${buildout:site-type}-${buildout:site-name}.conf
server-name = XXX
port = 80
haproxy-host = ${skeleton-supervisor:host}
haproxy-port = ${buildout:port-prefix}00
media-root = ${buildout:directory}/../media-qa
static-root = ${buildout:directory}/static
downloads-root = downloads
log = ${buildout:directory}/../log/skeleton-qa-${buildout:site-type}-${buildout:site-name}/nginx.log
error-log = ${buildout:directory}/../log/skeleton-qa-${buildout:site-type}-${buildout:site-name}/nginx-error.log

[skeleton-haproxy]
recipe = collective.recipe.template
input = buildout_templates/haproxy.cfg.in
output = ${buildout:directory}/haproxy/skeleton-qa-${buildout:site-name}.cfg
host = 127.0.0.1
port-prefix = ${buildout:port-prefix}
name = skeleton-qa-${buildout:site-name}

[directories]
recipe = z3c.recipe.mkdir
paths = 
    ../media-qa/uploads
    ../media-qa/downloads
    ../log/skeleton-qa-${buildout:site-type}-${buildout:site-name}

[media-links]
recipe = svetlyak40wt.recipe.symlinks
path = ${buildout:directory}/../media-qa
files =
    ${buildout:directory}/src/django-ckeditor/ckeditor/media/ckeditor
